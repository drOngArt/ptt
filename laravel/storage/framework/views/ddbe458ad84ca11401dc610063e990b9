<?php $__env->startSection('title'); ?>
    Program
<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>
    <div id="page-wrapper">
        <?php if( $cmd == false): ?>
            <?php echo Form::open(array('method' => 'post', 'action' => array('Admin\DashboardController@postFinalProgram'))); ?>

        <?php else: ?>
            <?php echo Form::open(array('method' => 'get','action' => array('Admin\DashboardController@selectedCategories', 'something'))); ?>

        <?php endif; ?>
        <div class="row">
            <div class="col-lg-12">
                <?php if( $cmd == false): ?>
                    <h1 class="page-header">Podgląd programu
                <?php else: ?>
                    <h1 class="page-header">Podgląd nowego programu
                <?php endif; ?>
                <div class="pull-right">
                    <?php echo Form::submit('Zatwierdź', array('id'=>'submitButton1', 'class' => 'btn btn-primary button-menu')); ?>

                </div>
                </h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>
                                    Lp.
                                </th>
                                <th>
                                    Runda
                                </th>
                                <?php if( $cmd != false): ?>
                                <th  colspan="10">
                                    Tańce
                                </th>
                                <?php endif; ?>
                            </tr>
                        </thead>
                        <tbody id="sortable1" class="connectedSortable">
                            <?php $idx = 0 ?>
                            <?php foreach($program as $programKey => $programRound): ?>
                                <tr>
                                    <td class="btn-circle">
                                        <?php echo e($idx+1); ?>.
                                        <?php $idx = $idx+1 ?>
                                    </td>
                                <?php if($programRound->isDance && isset($programRound->bg_color)): ?>
                                    <td style="background-color: <?php echo e($programRound->bg_color); ?>;">
                                <?php elseif( $programRound->isDance ): ?>
                                   <td >
                                <?php else: ?>
                                    <td class="text-muted">
                                <?php endif; ?>
                                    <?php echo e($programRound->description); ?>

                                    <input hidden name="roundId[]" value="<?php echo e($programKey); ?>">
                                    <input hidden name="roundName[]" value="<?php echo e($programRound->description); ?>">
                                    <input hidden name="isDance[]" value="<?php echo e($programRound->isDance); ?>">
                                    </td>
                                <?php if( $cmd == false): ?>
                                    <?php if($programRound->isDance): ?>
                                        <?php foreach($programRound->dances as $danceKey => $programRoundDance): ?>
                                        <td>
                                            <input hidden name="<?php echo e($programKey); ?>DanceName[]" value="<?php echo e($programRoundDance); ?>">
                                            <?php $dbRound = \App\Round::where('description', '=', trim($programRound->description))->where('dance', '=', $programRoundDance)->first()?>
                                            <?php if( !is_null($dbRound) and $dbRound->closed == 1): ?>
                                                &nbsp<input type="checkbox" id="<?php echo e($programKey); ?><?php echo e($danceKey); ?>" name="<?php echo e($programKey); ?><?php echo e($programRoundDance); ?>" checked>
                                            <?php else: ?>
                                                &nbsp<input type="checkbox" id="<?php echo e($programKey); ?><?php echo e($danceKey); ?>" name="<?php echo e($programKey); ?><?php echo e($programRoundDance); ?>">
                                            <?php endif; ?>
                                            <label for="<?php echo e($programKey); ?><?php echo e($danceKey); ?>">
                                            &nbsp&nbsp<?php echo e($programRoundDance); ?>

                                            </label>
                                        </td>
                                        <?php endforeach; ?>
                                    <?php endif; ?>
                                 <?php else: ?>
                                    <?php if($programRound->isDance): ?>
                                        <td>
                                        <?php foreach($programRound->dances as $danceKey => $programRoundDance): ?>
                                            <input hidden name="<?php echo e($programKey); ?>DanceName[]" value="<?php echo e($programRoundDance); ?>">
                                            <label for="<?php echo e($programKey); ?><?php echo e($danceKey); ?>">
                                            <?php echo e($programRoundDance); ?>

                                            </label>
                                        <?php endforeach; ?>
                                        </td>
                                    <?php endif; ?>
                                <?php endif; ?>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="pull-right">
                    <?php echo Form::submit('Zatwierdź', array('id'=>'submitButton2', 'class' => 'btn btn-primary button-menu')); ?>

                </div>
            </div>
        </div>
        <?php echo Form::close(); ?>

        <?php echo Session::put('new_program', $program); ?>

    </div>
    <!-- /#page-wrapper -->
<?php $__env->stopSection(); ?>

<?php $__env->startSection('customScripts'); ?>
   <?php echo HTML::script('js/jquery-ui.min.js'); ?>

   <script>
      $(function() {
         var removeIntent = false;
         $( "#sortable1" ).sortable({
            connectWith: ".connectedSortable",
            update:
               function(event,ui){
                  console.log("update", event);
                  $(this).find('tr').each(function(i){
                     $(this).find('td:first').text(i+1);
                  });
               }, 
            start: 
               function (event, ui){
                  ui.item.css('background-color', '#F2F5A9');
                  ui.item.css('border-radius','8px');
                  ui.item.css('border', '2px solid #428bca');
               },
               over: 
                  function (event,ui) {
                     removeIntent = false;
                  },
               out: 
                  function (event,ui) {
                     removeIntent = true;
                  },
               beforeStop:  
                  function(event,ui){
                     if(removeIntent == true){
                        ui.item.remove();
                     };
                  },
            stop: 
               function(event,ui){
                  //console.groupCollapsed("Sorting stopped");
                  //console.log("this", this);
                  //console.log("event", event);
                  //console.log("ui", ui);
                  //console.groupEnd();
                  ui.item.css('border', '');
                  ui.item.css('background-color', '#E0F8E0');
               },
         });
         $( 'td' ).each(function(){
             $(this).css('width', $(this).width() +'px');
         });
      }).disableSelection();
    </script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('admin.master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>